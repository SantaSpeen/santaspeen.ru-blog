---
slug: wildcard-ssl-cert
title: Auto wildcard cert service
description: –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å wildcard ssl —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ –¥–æ–º–µ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Cloudflare –∏ acme.sh
image: ./wildcard-logo.png
tags: [ssl, cloudflare, cert, wildcard, linux, docker, acme]
date: 2023-09-23T10:00
---

–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å wildcard SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ –¥–æ–º–µ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Cloudflare –∏ acme.sh


[![wildcard ssl cert](./wildcard-logo.png)](/blog/wildcard-ssl-cert)


<!--truncate-->
## Wildcard —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

–ù—Ä–∞–≤–∏—Ç—Å—è –∏–∑—É—á–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ OpenSource –ø—Ä–æ–µ–∫—Ç—ã, –∏ —Å–µ–π—á–∞—Å –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é —É —Å–µ–±—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã SSL

–ò–º–µ–µ—Ç—Å—è —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω `akmalov.com` –∏ –ø–æ–¥–¥–º–µ–Ω—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è `*.akmalov.com` —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω—å—à–µ –ø—Ä–æ–±–æ–≤–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Ü–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø—Ä–æ–ø–∏—Å—ã–≤–∞–ª –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–≤–∞–ª —Å–∞–º–ø–æ–ø–æ–¥–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–æ—á–µ–Ω—å –Ω–µ—É–¥–æ–±–Ω–æ, —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø–µ—Å–æ—á–Ω–∏—Ü—ã). 
–î–∞–ª–µ–µ —Ä–µ—à–∏–ª –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã –∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ –∑–∞–∫–∞–∑—ã–≤–∞–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é **Let's Encrypt** –∏ –∫–æ–≥–¥–∞ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ –Ω–∞–±—Ä–∞–ª–æ—Å—å –±–æ–ª—å—à–µ –¥–µ—Å—è—Ç–∫–∞ —Ä–µ—à–∏–ª –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å **wildcard** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤.

> –û–¥–∏–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤

[![wildcard](./wildcard.jpg)](./wildcard.jpg)


## ACME Shell script

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–µ—Ä–µ–ø—Ä–æ–±–æ–≤–∞–ª —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, –¥–ª—è –º–µ–Ω—è —Å–∞–º—ã–º —É–¥–æ–±–Ω—ã–º –ø–æ–∫–∞–∑–∞–ª—Å—è **acme.sh**

–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ñ—Ñ [Github](https://github.com/acmesh-official/acme.sh)

- Unix shell —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ù–µ –Ω—É–∂–Ω—ã root –ø—Ä–∞–≤–∞
- –ï—Å—Ç—å docker –æ–±—Ä–∞–∑
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç IPv6
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ cron-job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –£–º–µ–µ—Ç –ø–æ API –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ Cloudflare


## Cloudflare

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ DNS –∑–∞–ø–∏—Å—è–º–∏ –¥–æ–º–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É—é Cloudflare, –∏–∑ –∑–∞ –µ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ API, –¥–ª—è –º–Ω–æ–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –µ—Å—Ç—å –æ—á–µ–Ω—å —É–¥–æ–±–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –û–¥–Ω–∞ –∏–∑ –ø—Ä–∏—á–∏–Ω –≤—ã–±–æ—Ä–∞ acme.sh —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑, —Ç–æ —á—Ç–æ –æ–Ω –¥—Ä—É–∂–∏—Ç Cloudflare.

:::note
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–π —Å–ø–æ—Å–æ–± —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –≥–¥–µ –ø—Ä–∏–¥–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å `TXT` –∑–∞–ø–∏—Å–∏ –≤ –∞–¥–º–∏–Ω–∫–µ –¥–æ–º–µ–Ω–∞
:::

–ü–æ—à–∞–≥–æ–≤–æ –ø–æ–ª—É—á–µ–Ω–∏–µ API —Ç–æ–∫–µ–Ω–∞ –≤ Cloudflare:
- –í–æ–π—Ç–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç [Cloudflare](https://dash.cloudflare.com)
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É –ø—Ä–æ—Ñ–∏–ª—è –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –∏ –≤—ã–±—Ä–∞—Ç—å **My Profile** –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º –º–µ–Ω—é.
- –î–∞–ª–µ–µ –≤—ã–±–µ—Ä–∏—Ç–µ **API Tokens** –Ω–∞ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –º–µ–Ω—é.
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É **Create Token** –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–µ–Ω, –∑–∞–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–∞. 
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å  **API Token** –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–æ–ª—å—à–µ –µ–≥–æ —É–≤–∏–¥–µ—Ç—å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å)

:::danger –û—Å—Ç–æ—Ä–æ–∂–Ω–æ
–¢–æ–∫–µ–Ω –Ω–µ–ª—å–∑—è —Å–≤–µ—Ç–∏—Ç—å –≥–¥–µ –ø–æ–ø–∞–ª–æ
:::

[![Cloudflare](./cloudflare-api.png)](./cloudflare-api.png)

## Docker acme.sh

–ö–∞–∫ –æ–¥–∏–Ω –∏–∑ –±–æ–ª—å—à–∏—Ö –ø–æ–∫–ª–æ–Ω–Ω–∏–∫–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –Ω–µ —Ñ–∞–Ω–∞—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —á—Ç–æ-–ª–∏–±–æ –Ω–∞ —Ö–æ—Å—Ç —Å–∏—Å—Ç–µ–º—É, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤. 
–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —Ç–∞–∫–æ–≥–æ –∂–µ –º–Ω–µ–Ω–∏—è üíï

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ Github - [**Run acme.sh in docker**](https://github.com/acmesh-official/acme.sh/wiki/Run-acme.sh-in-docker)

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ [**Dockerhub**](https://hub.docker.com/r/neilpang/acme.sh)

–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∏–ª–∏ tag `latest`, –ø—Ä–∏–≤—ã–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é:
```bash
docker pull neilpang/acme.sh:3.0.6 
```

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª, —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:
```
EMAIL=artur@example.com
URL=example.com
WILDCARD_URL=*.example.com

CF_Token=Your cloudflare API TOKEN
```

–í –Ω–∞—á–∞–ª–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ACME –ø–æ **email**, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞.

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ñ–∞–π–ª, –Ω—É–∂–µ–Ω –±—É–¥–µ—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–ö–æ–º–∞–Ω–¥–∞ `-v "./acme_data":/acme.sh` –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Ö–æ—Å—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–æ—Ç–æ—Ä—É—é –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è.
```bash
docker run --rm --env-file .env -v "./acme_data":/acme.sh neilpang/acme.sh:3.0.6 --register-account -m $EMAIL
```
–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞

``` 
> Create account key ok.
> Registered
> ACCOUNT_THUMBPRINT='ACCOUNT KEY'
```

–ó–∞–ø—Ä–æ—Å **wildcard** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
docker run --rm --env-file .env -v "./acme_data":/acme.sh neilpang/acme.sh:3.0.6 --issue -d $URL -d $WILDCARD_URL  --dns dns_cf
```

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 3-7 –º–∏–Ω—É—Ç

–í –ª–æ–≥–∞—Ö –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∑–∞–ø—Ä–æ—Å–∞:
``` 
> Multi domain='DNS:example.com,DNS:*.example.com'
> Getting domain auth token for each domain
> Getting webroot for domain='example.com'
> Getting webroot for domain='*.example.com'
> Adding record
> Added, OK
> The txt record is added: Success.
> Let's check each DNS record now. Sleep 20 seconds first.
> Checking example.com for _acme-challenge.example.com
> Domain example.com '_acme-challenge.example.com' success.
> All success, let's return
> Verifying: example.com
> Processing, The CA is processing your order, please just wait. (1/30)
> Success
> Removing DNS records.
> Removed: Success
> Downloading cert.
> Cert success.
```

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω –∏ –≥–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—Å—Ä–æ–∫ 3 –º–µ—Å—è—Ü–∞), –≤—Å–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./acme_data`
```bash
ls -la acme_data/example.com_ecc
```

```output
-rw-r--r-- 1456 Sep 24 18:33 example.com.cer
-rw-r--r--  566 Sep 24 18:33 example.com.conf
-rw-r--r--  477 Sep 24 18:29 example.com.csr
-rw-r--r--  202 Sep 24 18:29 example.com.csr.conf
-rw-------  227 Sep 24 18:28 example.com.key
-rw-r--r-- 2668 Sep 24 18:33 ca.cer
-rw-r--r-- 4124 Sep 24 18:33 fullchain.cer
```

–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–æ–º–∞–Ω–¥–æ–π:
```bash
openssl x509 -in acme_data/example.com_ecc/example.com.cer -text -noout
```

–∏–ª–∏ –æ–Ω–ª–∞–π–Ω —Å–µ—Ä–≤–∏—Å–æ–º [Certificate Decoder](https://www.sslshopper.com/certificate-decoder.html)

–î–∞–ª—å—à–µ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞–≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫—É–¥–∞ –Ω—É–∂–Ω–æ.

